name: Version Bump Check

on:
  workflow_dispatch:

jobs:
  check-version:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout PR branch
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Get current version
        id: current
        run: echo "version=$(node -p "require('./package.json').version")" >> $GITHUB_OUTPUT

      - name: Checkout main branch
        run: git checkout origin/main

      - name: Get main version
        id: main
        run: echo "version=$(node -p "require('./package.json').version")" >> $GITHUB_OUTPUT

      - name: Compare versions
        run: |
          echo "Main version: ${{ steps.main.outputs.version }}"
          echo "PR version: ${{ steps.current.outputs.version }}"

          if [ "${{ steps.main.outputs.version }}" == "${{ steps.current.outputs.version }}" ]; then
            echo "❌ ERROR: Version not bumped!"
            echo "Please update the version in package.json before merging."
            echo "Current: ${{ steps.main.outputs.version }}"
            echo "Required: Must be greater than ${{ steps.main.outputs.version }}"
            exit 1
          else
            echo "✅ Version bumped from ${{ steps.main.outputs.version }} to ${{ steps.current.outputs.version }}"
          fi
